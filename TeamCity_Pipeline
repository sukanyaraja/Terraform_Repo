# Detect changed components
CHANGED_COMPONENTS=$(git diff --name-only origin/main...HEAD | \
  grep "^components/" | cut -d/ -f2 | sort -u)

if [ -z "$CHANGED_COMPONENTS" ]; then
  echo "âœ… No component changes detected. Skipping build."
  exit 0
fi

# Build & push Docker images separately
for comp in $CHANGED_COMPONENTS; do
  echo "ðŸ”¨ Building $comp with single Dockerfile..."

  docker build \
    --build-arg COMPONENT=$comp \
    -t myregistry/$comp:${BUILD_NUMBER} .

  docker push myregistry/$comp:${BUILD_NUMBER}
done
